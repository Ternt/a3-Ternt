"use strict";(self.webpackChunkcs4241_c25_a2_short_stack=self.webpackChunkcs4241_c25_a2_short_stack||[]).push([[792],{172:(e,t,n)=>{var a=n(235),o=n(71),s=n(399),l=n(333),i=n(128),d=n(963),c=n(814),r=n(38),u=n(359),m=n(787);const p=e=>e.username[0]+e.password[0]+function(e){let t=0;for(let n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return t}(e.username+e.password).toString(),h=(e,t,n)=>{function a(e){return Math.floor(Math.random()*e)}let o="";switch(a(2)){case 0:{const n=a(e.length),s=a(e[n].length),l=e[n][s],i=a(t[2].length);o=`${l} of ${t[2][i]}`}break;case 1:switch(a(2)){case 0:{const e=a(t[0].length),n=t[0][e],s=a(2)+1,l=a(t[s].length);o=`The ${n}true of ${t[s][l]}`}break;case 1:{const e=n[a(n.length)],s=a(t[0].length);o=`The ${e} ${t[0][s]}`}}}return o},f=(e,t)=>{const n=e||document.body,p=n.clientWidth,h=n.clientHeight,f=new a.Z;f.background=new o.Q(2039583);const g=new s.u(40,p/h,.01,1e3),v=new l.J;v.shadowMap.enabled=!0,v.shadowMap.type=i.Wk7,v.toneMapping=i.FV,v.toneMappingExposure=1,v.setPixelRatio(window.devicePixelRatio),v.setSize(p,h),v.setAnimationLoop(E),n.appendChild(v.domElement);const b=new d.N(g,v.domElement);b.listenToKeyEvents(window),b.enableZoom=!1,b.enableDamping=!0,b.dampingFactor=.05,b.rotateSpeed=.7,b.maxPolarAngle=Math.PI/2,b.minPolarAngle=Math.PI/2,(new c.t).load("card.stl",(function(e){const t=new r.D({color:16777215});t.side=i.$EB;const n=new u.e(e,t);n.receiveShadow=!0,n.rotation.set(-Math.PI/10,0,0),f.add(n)}),(e=>{}),(e=>{console.log(e)}));const w=new m.n(16777215,100);w.position.set(1,4,1),w.angle=Math.PI/6,w.penumbra=1,w.decay=2,w.distance=0,w.castShadow=!0,w.shadow.mapSize.width=1024,w.shadow.mapSize.height=1024,w.shadow.camera.near=1,w.shadow.camera.far=10,w.shadow.focus=1,f.add(w),g.position.set(0,4,3.5),b.update();let y=!1;function E(){y&&function(){y=!1;const e=n.clientWidth,t=n.clientHeight;g.aspect=e/t,g.updateProjectionMatrix(),v.setSize(e,t)}(),b.update(),v.render(f,g)}window.addEventListener("resize",(()=>{y=!0})),E()},g=async()=>{const e=await fetch("user/check",{method:"GET"});if(e.ok){const t=await e.text();return JSON.parse(t)}},v=async()=>{await fetch("/user/logout",{headers:{"Content-Type":"application/json"},method:"POST"}),window.location.reload()},b=[["Arobash","Muraudim","Horumak","Dorimar","Babark","Oliwar","Gryuwar","Vanogri","Felagh","Gajener"]],w=[["Orb","Sphere","Staff","Axe","Blade","Hound","Golem","Door","Fleece","Valley"],["Iron","Light","Darkness","Steel","Fire"],["Avernus","Stormcrag","Shadowvale","Thornridge","Ironcliff"]],y=["Golden","Mystic","Fiery","Furious"],E={render:async()=>'\n            <div id="main" class="body-section flex-col justify-center items-center">\n                <div id="content-feed">\n                </div>\n                <h1 id="card-name" class="text-[2rem] font-[600]"></h1>\n                <div id="buttons" class="login-options"> \n                    <button id="randomize" class="button">Randomize</button>\n                </div>\n            </div>',after_render:async()=>{function e(e,t){e.style.transition=`opacity ${t/1e3}s`,e.style.opacity=0,setTimeout((()=>{e.style.display="none",document.body.removeChild(e)}),t)}JSON.parse(localStorage.getItem("visited"))||function(){const t=document.createElement("div");var n,a;t.classList.add("welcome-modal-container"),t.innerHTML='\n            <div class="welcome-modal-box">\n                <a class="welcome-modal-title">Greetings, traveler!</a>\n                <p class="welcome-paragraph">Welcome to <a class="inline-bold">Card Collector</a>! A realm where fortune favors the bold and chance decides your destiny! Here, you may summon a card from the mystical depths of the unknown. Will it be an old relic, a powerful artifact, or perhaps a humble token of luck? Only the fates know!</p>\n                <p class="welcome-paragraph">Once you\'ve found a card you like, you may choose to save it to your account, share it with fellow adventurers, or even trade it for a handsome sum! So step forth, my friend, and let the winds of chance guide you. Who knows what wonders await? A card, a trade, and a fortune to be made!</p>\n            </div>',n=t,a=()=>{document.onkeydown=null,e(t,1e3),e(o,1e3),document.getElementById("content-feed").classList.remove("blur"),document.onmousedown=null,localStorage.setItem("visited","true")},document.onmousedown=e=>{n.contains(e.target)||a()},document.onkeydown=n=>{document.onmousedown=null,e(t,1e3),e(o,1e3),document.getElementById("content-feed").classList.remove("blur"),document.onkeydown=null,localStorage.setItem("visited","true")};const o=document.createElement("div");o.id="dimming-div",document.getElementById("content-feed").classList.add("blur"),document.body.appendChild(t),document.body.appendChild(o)}();const t=await g();if(t.authenticated){const e=document.createElement("button");e.classList.add("action-icon","glow-hover","clickable"),e.textContent=t.username,"admin"===t.username?e.onclick=()=>{const e=window.location.origin;window.location.replace(`${e}/results`)}:e.onclick=()=>{const e=window.location.origin;window.location.replace(`${e}/account`)};const n=document.getElementById("login-button");if(n&&n.replaceWith(e),!document.getElementById("logout")){const e=document.getElementById("account-tabs"),t=document.createElement("div"),n=document.createElement("button");n.classList.add("action-icon","glow-hover","clickable"),n.id="logout",n.textContent="Logout",n.onclick=v,t.classList.add("menu-tabs"),t.appendChild(n),e.appendChild(t)}const a=document.getElementById("buttons"),o=document.createElement("button");o.id="add-card",o.classList.add("button"),o.textContent="Add Card",o.onclick=async()=>{await(async()=>{const e={cardname:document.getElementById("card-name").textContent},t=await fetch("/card/add",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(e)});if(t.ok){const e=await t.text();return JSON.parse(e)}})()&&document.getElementById("randomize").click()},a.prepend(o)}const n=document.getElementById("randomize"),a=document.getElementById("card-name");a.textContent=h(b,w,y),n.addEventListener("click",(()=>{a.textContent=h(b,w,y)}));const o=document.getElementById("content-feed");f(o)}},C=async function(e){e.preventDefault();const t={username:document.querySelector("#username").value,password:document.querySelector("#password").value},n=p(t),a=(JSON.parse(localStorage.getItem(n)),JSON.stringify(t));if((await fetch("/user/auth/login",{headers:{"Content-Type":"application/json"},method:"POST",body:a})).ok){const e=window.location.origin,t="";window.location.replace(`${e}/${t}`)}else{const e=document.getElementById("login-error");if(document.getElementsByClassName("error-message").length<1){const t=document.createElement("a");t.classList.add("error-message"),t.innerHTML="Incorrect user/pass",e.appendChild(t),setTimeout((()=>{const e=document.getElementById("login-error");e.removeChild(e.lastElementChild)}),1e4)}}},k={render:async()=>'\n            <div id="main" class="body-section">\n                <form class="login-form">\n                    <div class="auth-tabs">\n                        <button class="tab">\n                            <a href="/login">Login</a>\n                        </button>\n                        <button class="tab">\n                            <a href="/signup">Sign Up</a>\n                        </button>\n                    </div>\n                    <div class="form-area">\n                    <div class="form-box">\n                        <label class="form-label" for="username">Username </label>\n                        <input class="form-input" type="text" id="username" value="username">\n                    </div>\n                    <div class="form-box">\n                        <label class="form-label" for="password">Password</label>\n                        <input class="form-input" type="text" id="password" value="password">\n                    </div>\n                    <div class="form-box" id="form-submission">\n                        <button class="form-trigger" type="submit" id="form-button">Login</button>\n                    </div>\n                    <div id="login-error" class="form-label-group">\n                    </div> \n                    </div>\n                </form>\n            </div>',after_render:async()=>{let e;document.getElementById("form-button").onclick=C;const t=document.getElementsByClassName("form-input");for(let e=0;e<t.length;e++){const n=t[e];let a=n.defaultValue;n.onkeydown=e=>{"Escape"===e.key&&("contains-data"===n.classList[n.classList.length-1]&&n.classList.remove("contains-data"),n.value=a,n.addEventListener("input",o,{once:!0}),n.blur())};const o=e=>{"insertText"===e.inputType&&(a=n.defaultValue,n.value=e.data)};n.addEventListener("input",o,{once:!0}),n.onblur=()=>{n.value.length>0?n.classList.add("contains-data"):0===n.value.length&&("contains-data"===n.classList[n.classList.length-1]&&n.classList.remove("contains-data"),n.value=a)}}const n=document.getElementById("password");let a="";n.onfocus=()=>{e=n.defaultValue,n.defaultValue="",n.type="password"},n.onkeydown=e=>{"Escape"===e.key&&n.blur()},n.oninput=e=>{"insertText"===e.inputType&&(a=n.value)},n.onblur=()=>{n.defaultValue=e,0===a.length&&(n.type="type")}}},L=async function(e){e.preventDefault();const t={username:document.querySelector("#username").value,firstname:document.querySelector("#firstname").value,lastname:document.querySelector("#lastname").value,dateofbirth:document.querySelector("#dateofbirth").value,password:document.querySelector("#password").value},n=p(t);localStorage.setItem(n,JSON.stringify(t));const a=JSON.stringify(t);try{const e=await fetch("/user/register",{headers:{"Content-Type":"application/json"},method:"POST",body:a});if(!(await e.json()).success)throw new Error("Failed to register user");const t=window.location.origin,n="login";window.location.replace(`${t}/${n}`)}catch(e){console.error(e.message);const t=document.getElementById("user-error");if(document.getElementsByClassName("error-message").length<1){const e=document.createElement("a");e.classList.add("error-message"),e.innerHTML="User already exists. Try a new username",t.appendChild(e),setTimeout((()=>{const e=document.getElementById("user-error");e.removeChild(e.lastElementChild)}),1e4)}}},x={render:async()=>'\n            <div id="main" class="body-section">\n                <form class="login-form">\n                    <div class="auth-tabs">\n                        <button class="tab">\n                            <a href="/login">Login</a>\n                        </button>\n                        <button class="tab">\n                            <a href="/signup">Sign Up</a>\n                        </button>\n                    </div>\n                    <div class="form-area">\n                    <div class="form-box">\n                        <div id="user-error" class="form-label-group">\n                            <label class="form-label" for="username">Username </label>\n                        </div>\n                        <input class="form-input" type="text" id="username" value="username">\n                    </div>\n                    <div class="form-group">\n                        <div class="form-box">\n                            <label class="form-label" for="firstname">First Name</label>\n                            <input class="form-input" type="text" id="firstname" value="first name">\n                        </div>\n                        <div class="form-box">\n                            <label class="form-label" for="lastname">Last Name</label>\n                            <input class="form-input" type="text" id="lastname" value="last name">\n                        </div>\n                    </div>\n                    <div class="form-box">\n                        <label class="form-label" for="dob">Date of Birth</label>\n                        <input class="form-input" type="date" id="dateofbirth" value="date of birth">\n                    </div>\n                    <div class="form-box">\n                        <label class="form-label" for="lastname">Password</label>\n                        <input class="form-input" type="text" id="password" value="password">\n                    </div>\n                    <div class="form-box" id="form-submission">\n                        <input class="form-trigger" type="button" id="form-button" value="Sign up">\n                    </div>\n                    </div>\n                </form>\n            </div>',after_render:async()=>{let e;document.getElementById("form-button").onclick=L;const t=document.getElementsByClassName("form-input");for(let e=0;e<t.length;e++){const n=t[e];let a=n.defaultValue;n.onkeydown=e=>{"Escape"===e.key&&("contains-data"===n.classList[n.classList.length-1]&&n.classList.remove("contains-data"),n.value=a,n.addEventListener("input",o,{once:!0}),n.blur())};const o=e=>{"insertText"===e.inputType&&(a=n.defaultValue,n.value=e.data)};n.addEventListener("input",o,{once:!0}),n.onblur=()=>{n.value.length>0?n.classList.add("contains-data"):0===n.value.length&&("contains-data"===n.classList[n.classList.length-1]&&n.classList.remove("contains-data"),n.value=a)}}const n=document.getElementById("password");let a="";n.onfocus=()=>{e=n.defaultValue,n.defaultValue="",n.type="password"},n.onkeydown=e=>{"Escape"===e.key&&n.blur()},n.oninput=e=>{"insertText"===e.inputType&&(a=n.value)},n.onblur=()=>{n.defaultValue=e,0===a.length&&(n.type="type")}}},S=async function(e){e.preventDefault();const t={_id:e.originalTarget.dataset._id,collection:e.originalTarget.dataset.collection_name},n=await fetch("/data/delete",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t)}),a=await n.text();return JSON.parse(a)},T=async function(e,t){e.preventDefault();const n=e.originalTarget.parentNode,a={collection:n.parentNode.parentNode.parentNode.id,field:{_id:n.parentNode.dataset._id,key:n.dataset.key,value:n.dataset.value},value:t};console.log(a),await fetch("/data/change",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)})},I={render:async()=>{const e=await(async()=>{const e=await fetch("/data/all",{method:"GET"}),t=await e.text(),n=JSON.parse(t);return console.log(n),n})(),t=document.createElement("div");t.classList.add("page-container");for(let n=0;n<e.length;++n){const a=e[n],o=a.data,s=a.name,l=document.createElement("h1");l.textContent=s;const i=document.createElement("table");i.id=s;const d=document.createElement("tr");for(const[e,t]of Object.entries(o[0])){const t=document.createElement("th");t.innerHTML=e,t.setAttribute("headers",e),d.appendChild(t)}const c=document.createElement("th");d.appendChild(c),i.append(d);for(let e=0;e<o.length;e++){const{_id:t,name:n}=o[e],a=document.createElement("tr");a.dataset._id=t;for(const[t,n]of Object.entries(o[e])){const o=document.createElement("td");o.classList.add("table-cell"),o.dataset.value=n.toString(),o.dataset.key=t.toString(),o.setAttribute("header",t+"-"+(e+1)),o.textContent=n.toString(),a.appendChild(o)}const l=document.createElement("td"),d=document.createElement("button");l.classList.add("delete-cell"),d.setAttribute("id",e.toString()),d.dataset._id=t,d.dataset.collection_name=s,d.classList.add("delete-button"),d.textContent="delete",l.append(d),a.appendChild(l),i.appendChild(a)}const r=document.createElement("div"),u=document.createElement("div");r.classList.add("result-table-container"),u.classList.add("result-table"),u.appendChild(i),r.appendChild(l),r.appendChild(u),t.appendChild(r)}return t.outerHTML},after_render:()=>{let e,t=!1;const n=document.getElementsByClassName("table-cell");for(let a=0;a<n.length;a++){const o=n[a];o.onclick=()=>{if(t=!0,!o.firstChild)return void console.warn("There is no data to edit");if(3!==o.firstChild.nodeType&&!t)return;let n=document.createElement("input");n.setAttribute("id",`${o.attributes.header.value}`),n.setAttribute("size",1),n.classList.add("editable-field"),n.onblur=()=>{t=!1,n.parentNode.innerHTML=e},n.onkeydown=t=>{const a=n.value;switch(t.key){case"Escape":n.blur();break;case"Enter":e=a,T(t,a),n.blur()}},n.onclick=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()},e=o.firstChild.nodeValue,n.value=o.textContent,o.removeChild(o.firstChild),o.appendChild(n),document.getElementById(o.attributes.header.value).focus()}}const a=document.getElementsByClassName("delete-button");for(let e=0;e<a.length;e++)a[e].onclick=async e=>{await S(e).then((()=>{document.getElementById(e.originalTarget.dataset.collection_name).deleteRow(Number(e.originalTarget.id)+1)}))}}},B={render:async()=>'\n            <div id="main" class="body-section flex-col justify-center items-center">\n                <div class="flex flex-row">\n                    <div class="container carousel w-[fit-content] flex">\n                        <button id="backward" class="svg-buttons clickable">\n                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-compact-left"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M13 20l-3 -8l3 -8" /></svg> \n                        </button>\n                    </div>\n                    <div id="content-feed">\n                    </div>\n                    <div class="container carousel w-[fit-content]">\n                        <button id="forward" class="svg-buttons clickable">\n                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-chevron-compact-right"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 4l3 8l-3 8" /></svg> \n                        </button>\n                    </div>\n                </div>\n                <h1 id="card-name" class="text-[2rem] font-[600]"></h1>\n            </div>',after_render:async()=>{const e=await g();if(e.authenticated){const t=document.createElement("div");if(t.classList.add("action-icon","glow-hover","clickable"),t.textContent=e.username,t.onclick=()=>{window.location.replace("http://localhost:3000/account")},!document.getElementById("logout")){const e=document.getElementById("account-tabs"),t=document.createElement("div"),n=document.createElement("button");n.classList.add("action-icon","glow-hover","clickable"),n.id="logout",n.textContent="Logout",n.onclick=v,t.classList.add("menu-tabs"),t.appendChild(n),e.appendChild(t)}document.getElementById("login-button").replaceWith(t)}const t=await fetch("/card/get_user_cards",{method:"GET"}),n=await t.json(),a=document.getElementById("card-name");a.textContent=n.data[0].cardname;let o=0;document.getElementById("forward").onclick=e=>{o+=1,o>=n.data.length&&(o=0),a.textContent=n.data[o].cardname},document.getElementById("backward").onclick=e=>{o-=1,o<0&&(o=n.data.length-1),a.textContent=n.data[o].cardname};const s=document.getElementById("content-feed");f(s)}};localStorage.getItem("visited")||localStorage.setItem("visited","false"),document.addEventListener("DOMContentLoaded",(()=>{document.body.onclick=e=>{e.target.matches("[data-link]")&&(e.preventDefault(),O(e.target.href))},M()}));const N=[{path:404,title:"Error",view:()=>{console.log("error")}},{path:"/",title:"Collect Your Card • Card Collector",view:E},{path:"/signup",title:"Sign Up • Card Collector",view:x},{path:"/login",title:"Login • Card Collector",view:k},{path:"/results",title:"Card Collector - Results",view:I},{path:"/account",title:"Card Collector - User Account",view:B}],O=async e=>{history.pushState({},"",e),await M()},M=async()=>{let e=N.map((e=>({route:e,ismatch:location.pathname===e.path}))).find((e=>e.ismatch));e||(e={route:N[0],ismatch:!0});let t=await e.route.view.render();document.querySelector("#content").innerHTML=t,document.title=e.route.title,await e.route.view.after_render()};window.onpopstate=M}},e=>{e.O(0,[502],(()=>e(e.s=172))),e.O()}]);